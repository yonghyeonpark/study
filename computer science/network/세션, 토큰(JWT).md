# 세션, 토큰(JWT)

## 세션

- 서버 측에서 사용자의 상태 정보를 저장하는 방식입니다.
- 서버가 생성한 `SessionID`를 브라우저가 쿠키에 저장하여 요청마다 전송합니다.
- `쿠키-세션` 방식은 웹의 전통적인 인증 방식입니다.
- **장점**
    - 서버에서 세션 상태 제어가 쉽습니다.
    - 만료된 세션을 즉시 무효화 가능합니다.
    - 클라이언트에 최소한의 정보만 저장합니다.
- **단점**
    - 서버 메모리(`JVM 힙`)이나 DB에 세션 정보를 저장합니다.
    - 서버 메모리에 저장 시, 서버를 재시작하면 세션 정보가 휘발됩니다.
    - 요청마다 세션 정보를 조회해야 해서 DB 사용 시, 병목 현상이 발생할 수 있습니다.
    - 분산 서버 환경에서 세션 정보 동기화가 필요합니다.

## 토큰(JWT)

- `JSON` 포맷을 이용하여 사용자에 대한 속성을 저장하는 `Claim` 기반의 `Web Token`입니다.
- 클라이언트 측(일반적으로 `로컬 저장소`)에서 토큰을 저장하고 관리합니다.
- **장점**
    - 무상태성(`Stateless`)을 갖춰 서버 확장에 용이합니다.
    - 토큰을 서버에 저장할 필요 없이 토큰 자체로 검증이 가능합니다.
- **단점**
    - 토큰 하이재킹 위험이 있고, 한번 발급된 토큰은 만료 전까지 제어가 어렵습니다.
    - 토큰에 여러 정보가 담겨있기 때문에 정보의 노출 위험이 있습니다.
- 주의 사항
    - 디코딩이 쉽기 때문에 사용자의 민감한 정보를 그대로 저장하면 안 됩니다.
    - 브루트 포스 공격에 대비해 비밀 키를 매우 길고 복잡하게 설정하는 것이 좋습니다.
- **구조**
    - **Header**
        - 토큰 유형(일반적으로 JWT)과 `HMAC SHA256` 또는 `RSA`와 같은 서명 알고리즘의 두 부분으로 구성됩니다.
        - `Base64Url`로 인코딩되어 JWT의 첫 번째 부분을 형성합니다.
    - **Payload (JWT Claim Set)**
        - 토큰에 포함될 내용인 클레임을 포함하며, 표준 필드인 7개의 `Registerd Claims` 및 사용자 지정 클레임 등으로 구성합니다.
        - `Base64Url`로 인코딩되어 JWT의 두 번째 부분을 형성합니다.
    - **Signature**
        1. `Base64Url`을 이용하여 헤더와 페이로드를 인코딩하고 이 둘을 `.` 구분자로 함께 연결합니다.
        2. 인코딩한 값을 비밀 키를 이용해 헤더에서 정의한 알고리즘으로 해싱하고, 이 값을 다시 `Base64Url`로 인코딩하여 JWT의 마지막 부분을 형성합니다.
- **Registerd Claims**
    - 필수가 아닌 선택사항입니다.
    - `iss(Issuer)` : 토큰 발급자
    - `sub(Subject)` : 토큰 제목 (일반적으로 사용자 식별자 사용)
    - `aud(Audience)` : 토큰 대상자
    - `exp(Expiration Time)` : 토큰 만료 시간
    - `nbf(Not Before)` : 토큰 활성 시작 시간
    - `iat(Issued At)` : 토큰 발급 시간
    - `jti(JWT ID)` : JWT의 고유 식별자