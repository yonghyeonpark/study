# 프로세스

- 프로세스는 생성 시 `독립된` 메모리 공간을 할당받으며, 프로그램 종료 시 폐기됩니다. 
- 컨텍스트 스위칭 발생 시에는 CPU 자원만 반환하고, 메모리는 유지됩니다.

## PCB(Process Control Block)

- `커널 영역`에 생성되며, 프로세스 관리에 필요한 정보를 담고 있습니다.
- 운영체제마다 차이가 있지만 주요 정보는 다음과 같습니다.
  - 포로세스 ID
  - 레지스터값
  - 프로세스 상태
  - CPU 스케줄링 정보
  - 메모리 관리 정보
  - 입출력 디바이스와 파일 정보

## 메모리 구조
<img src = "https://github.com/user-attachments/assets/907278de-563f-45bc-bbbc-3a666de39bab" width="370" height="370"><br>
- **코드 영역 (텍스트 영역)**
  - 컴파일된 기계어 명령어가 저장됩니다.
  - 읽기 전용으로 수정할 수 없습니다.
  - 자바에서는 `.class` 파일의 바이트코드가 저장됩니다.
- **데이터 영역**
  - 프로그램이 실행 중 유지되어야 하는 데이터가 저장됩니다.
  - `전역 변수`가 이 영역에 할당됩니다.
- **힙 영역**
  - 개발자가 직접 메모리를 `할당/해제`하는 영역입니다.<br>
    (제대로 반환해 주지 않으면 `메모리 누수`의 위험이 있습니다.)
  - 자바에서는 `new` 연산자로 생성된 객체가 이 영역에 저장되며,`GC`가 자동으로 메모리를 관리합니다.
- **스택 영역**
  - 함수 실행에 필요한 `지역 변수`, `매개 변수`, `반환 주소`가 저장됩니다.
  - 함수 호출 시 자동으로 할당되고, 종료 시 해제됩니다.

# 스레드

## TCB(Thread Control Block)

- 커널 영역에 저장되며, 스레드 관리에 필요한 정보를 담고 있습니다.
- 주요 정보
  - 스레드 ID
  - 레지스터값
  - 스택 포인터 (스레드별 스택 영역 위치)

## 메모리 구조
<img src = "https://github.com/user-attachments/assets/7959504f-5569-4636-bbef-ed6d37af0b78" width="300" height="380"><br>

- 같은 프로세스의 스레드들은 `코드`, `데이터`, `힙` 영역을 공유합니다.
- 각 스레드는 독립적인 `스택` 영역을 가집니다.

# 컨텍스트 스위칭

- 컨텍스트 스위칭은 `CPU/코어`에서 실행 중이던 `프로세스/스레드`가 다른 `프로세스/스레드`로 교체되는 것을 의미합니다.<br>
  (정확히 말하면, 프로세스 간의 컨텍스트 스위칭은 한 프로세스 내부의 스레드가 다른 프로세스 내부의 스레드로 교체되는 것을 뜻합니다.)
- 커널 모드에서 실행되며, `PCB` 또는 `TCB`를 참고하여 CPU의 레지스터 상태를 저장하고 복원합니다.

## 프로세스 컨텍스트 스위칭 & 스레드 컨텍스트 스위칭

- **MMU(Memory Management Unit)** 수정 및 **TLB(Translation Lookaside Buffer)** 플러시
  - `프로세스 컨텍스트 스위칭` 시, 서로 다른 가상 메모리 주소 공간을 사용하는 프로세스 간 전환이므로, `MMU`에서 사용하는 페이지 테이블을 새 프로세스의 페이지 테이블로 교체해야 합니다.
  - 또한, 가상 주소와 물리 주소 매핑 정보를 캐싱한 `TLB`도 초기화해야 합니다.
- 따라서 메모리 주소 관련 작업이 필요 없는 `스레드 컨텍스트 스위칭`이 더 빠릅니다.<br>

<br>

> 페이지 테이블은 가상 주소와 물리 주소를 매핑하는 자료 구조입니다.

## CPU 캐시에 미치는 영향

- 컨텍스트 스위칭(특히 프로세스 전환)이 발생하면, 이전 프로세스의 데이터가 CPU 캐시에 남아있게 됩니다.
- 새로운 프로세스 실행 시, 이 데이터는 무효화되며, 필요한 데이터를 다시 메모리에서 가져와야 합니다.
- 이로 인해 성능 저하로 이어질 수 있습니다.