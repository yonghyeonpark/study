# 기본 키 생성 전략

## 직접 생성

- `@Id` 어노테이션만을 사용하여 직접 Id 값을 할당하는 방식입니다.

## 자동 생성

```java
@Id
@GeneratedValue(strategy = GenerationType.~)
```

### IDENTITY 전략

- 기본 키 생성을 데이터베이스에 위임하는 전략입니다.
- `MySQL`의 경우 `AUTO_INCREMENT`를 사용하여 자동으로 증가하는 값을 생성합니다.
- 엔터티가 영속 상태가 되기 위해서는 식별자가 반드시 필요한데, `IDENTITY` 전략은 엔터티를 데이터베이스에 저장해야만 식별자를 구할 수 있습니다.
- 따라서 `em.persist()`를 호출하는 즉시 `INSERT` 쿼리가 데이터베이스에 전달되며, 쓰기 지연이 동작하지 않습니다.

### SEQUENCE 전략

- 데이터베이스 시퀀스는 유일한 값을 순서대로 생성하는 데이터베이스 객체입니다. `SEQUENCE` 전략은 이 시퀀스를 사용하여 기본 키를 생성합니다.
- 시퀀스 키 생성 전략을 지원하는 데이터베이스에서만 사용할 수 있습니다.
- `em.persist()`를 호출 시, 우선 데이터베이스 시퀀스를 사용하여 식별자를 조회합니다.
- 조회한 식별자를 엔터티에 할당한 후, 엔터티를 영속성 컨텍스트에 저장합니다.
- 이후 트랜잭션 커밋 시, 플러시가 일어나면 엔터티를 데이터베이스에 저장합니다. (이 부분이 `IDENTITY` 전략과의 차이점입니다.)
- `@SequenceGenerator`의 속성을 통해 시퀀스의 종류, 시작 값, 증가 값 등을 설정할 수 있습니다.

### TABLE 전략

- 키 생성 전용 테이블을 하나 만들고, 이름과 값으로 사용할 컬럼을 만들어 데이터베이스 시퀀스를 흉내내는 전략입니다.
- `@TableGenerator`의 속성을 통해 테이블, 시작 값, 증가 값 등을 설정할 수 있습니다.
- 테이블을 사용하기 때문에 모든 데이터베이스에서 사용 가능하다는 장점이 있습니다.
- `TABLE` 전략은 값을 조회하면서 `SELECT` 쿼리를 사용하고, 다음 값으로 증가시키기 위해 `UPDATE` 쿼리를 사용합니다.
- 이로 인해 `SEQUENCE` 전략과 비교하여 데이터베이스와 한 번 더 통신해야 한다는 단점이 있습니다.

### AUTO 전략

- 선택한 데이터베이스 방언에 따라 위의 세 전략 중 하나를 자동으로 선택합니다.
- `MySQL`의 경우 `IDENTITY` 전략으로 동작합니다.
- 데이터베이스를 변경하더라도 코드를 수정할 필요가 없다는 장점이 있습니다.

## 참고

- [자바 ORM 표준 JPA 프로그래밍](https://www.yes24.com/product/goods/19040233)