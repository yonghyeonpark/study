# IOC, DI, 컨테이너

## 제어의 역전(IoC, Inversion of Control)

- 전통적인 프로그래밍에서는 개발자가 직접 객체를 생성하고 흐름을 제어했습니다.
- 하지만 `IoC`를 적용하면 프레임워크가 제어 흐름을 관리하여, 객체는 자신의 핵심 로직 실행에만 집중할 수 있습니다.
- 객체는 프레임워크에 의해 관리되므로, 다른 객체를 직접 생성하거나 제어할 필요가 없습니다.

## 의존관계 주입(DI, Dependency Injection)

- 객체가 필요로 하는 `의존성`을 외부에서 주입 받는 방식입니다.
- 애플리케이션의 실행 시점(`런타임`)에 실제 구현 객체가 주입되므로, 코드 변경 없이 구현체를 교체할 수 있습니다.
- 인터페이스에만 의존하므로 결합도가 낮아지고 유연성이 향상됩니다.
- 단위 테스트가 쉬워집니다. (Mock 객체 주입 가능)

## DI 컨테이너(IoC 컨테이너)

- 객체의 생명주기와 의존관계를 관리하는 컴포넌트입니다.
- 빈 등록 방식
    - **수동 등록**
        - `@Configuration` 클래스에서 `@Bean` 사용 (자바 코드)
        - `XML` 설정 파일 작성
    - **자동 등록**
        - `@Component`와 그 하위 어노테이션(`@Service`, `@Repository` 등)을 사용합니다.
        - `@ComponentScan`으로  빈 등록 대상을 검색합니다.
        - Spring Boot에서는 `@SpringBootApplication`이 `@ComponentScan`을 포함합니다.

## 스프링 컨테이너

- 스프링 컨테이너는 `XML` 설정 파일 또는 자바 설정 클래스(`@Configuration`)로 생성할 수 있습니다.<br>(설정 파일 및 클래스 없이 `컴포넌트 스캔`만으로도 가능)
- 빈 등록 시, 이름은 고유해야 합니다.
- 자바 설정에서 빈 이름은 기본적으로 메서드 이름을 사용하며, `@Bean(name="")`을 사용해 직접 지정할 수도 있습니다.
- **빈 조회**
    - 타입으로 조회 시, 동일한 타입의 빈이 여러 개면 이름으로 지정해서 조회해야 합니다.
    - 부모 타입으로 조회하면 자식 타입도 함께 조회됩니다.
- **스프링 컨테이너 종류**
  - **BeanFactory**
      - 스프링 컨테이너의 최상위 인터페이스
      - 빈 관리와 조회 기능(`getBean()` 등)을 제공합니다.
  - **ApplicationContext**
      - `BeanFactory`의 모든 기능을 상속합니다.
      - 추가 기능들
          - 국제화를 위한 메시지 소스 관리
          - 환경변수 관리
          - 애플리케이션 이벤트 발행/구독
          - 리소스 로딩
- **상속 관계**<br><img src = "https://github.com/user-attachments/assets/969a7b27-9092-420b-9b86-900f1da9c8e0" width ="700" height="450"><br>
- `BeanFactory`를 직접 사용할 일은 거의 없고, 부가 기능이 포함된 `ApplicationContext`를 사용합니다.

## 싱글톤 컨테이너

- 스프링 컨테이너는 기본적으로 스프링 빈을 `싱글톤`으로 관리합니다.
- 싱글톤 빈은 상태를 가지면 안 됩니다.
    - 여러 클라이언트가 하나의 객체를 사용하므로, `공유 필드`를 사용하지 않아야 합니다.
    - 필드 대신 `지역변수`, `파라미터`, `ThreadLocal` 등을 사용해야 합니다.
- `@Configuration`이 붙은 클래스를 빈으로 등록하는 과정에서 `CGLIB`라는 바이트코드 조작 라이브러리가 사용되는데, 이를 통해 설정 클래스가 빈들의 싱글톤을 보장해 줍니다.
    - `@Bean`이 붙은 메서드가 여러 번 호출되어도 같은 빈을 반환합니다.

## BeanDefinition

- 스프링 빈 설정 메타 정보입니다.
- `XML` 설정 파일이나 `자바` 설정 클래스는 내부적으로 `BeanDefinition`으로 변환됩니다.
- 스프링은 이 메타 정보를 기반으로 빈을 생성하고 관리합니다.
- 설정 방식과 관계없이 `BeanDefinition`이라는 추상화 덕분에 일관된 방식으로 빈의 생성과 관리가 가능합니다.<br><img src="https://github.com/user-attachments/assets/90ff000e-f1d2-4bf7-be43-2feae7a93a11" width ="550" height="300">